# NQæœŸè´§å›æµ‹ç³»ç»Ÿ - ä½¿ç”¨è¯´æ˜

## ğŸ“– å¿«é€Ÿå¼€å§‹

### æœ€ç®€å•çš„ç”¨æ³•
```bash
python backtrader_demo.py
```
è¿™å°†ä½¿ç”¨é»˜è®¤å‚æ•°è¿è¡Œï¼š2024å¹´å…¨å¹´æ•°æ®ï¼Œ1åˆ†é’ŸKçº¿

## ğŸ¯ å‘½ä»¤è¡Œå‚æ•°

### å‚æ•°åˆ—è¡¨

| å‚æ•° | ç±»å‹ | è¯´æ˜ | é»˜è®¤å€¼ |
|------|------|------|--------|
| `--start` | æ—¥æœŸ | å¼€å§‹æ—¥æœŸï¼ˆYYYY-MM-DDï¼‰ | 2024-01-01 |
| `--end` | æ—¥æœŸ | ç»“æŸæ—¥æœŸï¼ˆYYYY-MM-DDï¼‰ | 2024-12-31 |
| `--timeframe` | é€‰é¡¹ | Kçº¿å‘¨æœŸ | m1 |
| `--data` | è·¯å¾„ | æ•°æ®æ–‡ä»¶è·¯å¾„ | btc_m1_cleaned.csv |
| `--save-trades` | å¼€å…³ | ä¿å­˜äº¤æ˜“è®°å½•åˆ°CSV | ï¼ˆä¸ä¿å­˜ï¼‰ |
| `--plot` | å¼€å…³ | ç”Ÿæˆå¯è§†åŒ–å›¾è¡¨ | ï¼ˆä¸ç”Ÿæˆï¼‰ |

### Kçº¿å‘¨æœŸé€‰é¡¹

| å€¼ | è¯´æ˜ | æ¨èåœºæ™¯ |
|----|------|----------|
| `m1` | 1åˆ†é’Ÿ | é«˜é¢‘äº¤æ˜“ã€è¶…çŸ­çº¿ |
| `m5` | 5åˆ†é’Ÿ | æ—¥å†…çŸ­çº¿ |
| `m15` | 15åˆ†é’Ÿ | æ—¥å†…æ³¢æ®µ |
| `m30` | 30åˆ†é’Ÿ | æ—¥å†…æ³¢æ®µ |
| `h1` | 1å°æ—¶ | çŸ­æœŸè¶‹åŠ¿ |
| `h4` | 4å°æ—¶ | ä¸­æœŸè¶‹åŠ¿ |
| `d1` | æ—¥çº¿ | é•¿æœŸè¶‹åŠ¿ |

## ğŸ’¡ ä½¿ç”¨ç¤ºä¾‹

### 1. åŸºç¡€ç¤ºä¾‹

#### é»˜è®¤è¿è¡Œ
```bash
python backtrader_demo.py
```

#### æŒ‡å®šæ—¶é—´èŒƒå›´
```bash
python backtrader_demo.py --start 2024-01-01 --end 2024-06-30
```

#### ä½¿ç”¨ä¸åŒKçº¿å‘¨æœŸ
```bash
# 5åˆ†é’ŸKçº¿
python backtrader_demo.py --timeframe m5

# 1å°æ—¶Kçº¿
python backtrader_demo.py --timeframe h1

# æ—¥çº¿
python backtrader_demo.py --timeframe d1
```

### 2. ä¿å­˜äº¤æ˜“è®°å½•

```bash
# ä¿å­˜äº¤æ˜“è®°å½•åˆ°CSV
python backtrader_demo.py --timeframe h1 --save-trades

# æŒ‡å®šæ—¶é—´èŒƒå›´å¹¶ä¿å­˜
python backtrader_demo.py --timeframe m5 --start 2024-01-01 --end 2024-06-30 --save-trades
```

äº¤æ˜“è®°å½•ä¿å­˜ä½ç½®ï¼š`backtest_results/trades_*.csv`

### 3. ç”Ÿæˆå›¾è¡¨

```bash
# ç”Ÿæˆå¯è§†åŒ–å›¾è¡¨
python backtrader_demo.py --timeframe d1 --plot

# æŒ‡å®šæ—¶é—´èŒƒå›´å¹¶ç”Ÿæˆå›¾è¡¨
python backtrader_demo.py --timeframe h4 --start 2024-01-01 --end 2024-12-31 --plot
```

å›¾è¡¨å°†æ˜¾ç¤ºåœ¨çª—å£ä¸­ï¼Œå…³é—­çª—å£åç¨‹åºç»§ç»­æ‰§è¡Œã€‚

### 4. å®Œæ•´åŠŸèƒ½ç»„åˆ

```bash
# ä¿å­˜è®°å½• + ç”Ÿæˆå›¾è¡¨
python backtrader_demo.py --timeframe h1 --save-trades --plot

# å®Œæ•´å‚æ•°ç¤ºä¾‹
python backtrader_demo.py \
  --start 2024-01-01 \
  --end 2024-06-30 \
  --timeframe h4 \
  --data btc_m1_cleaned.csv \
  --save-trades \
  --plot
```

### 5. ç‰¹å®šåœºæ™¯ç¤ºä¾‹

#### æµ‹è¯•æœ€è¿‘ä¸€ä¸ªæœˆï¼ˆå¿«é€ŸéªŒè¯ï¼‰
```bash
python backtrader_demo.py --timeframe d1 --start 2024-11-01 --end 2024-12-31
```

#### æµ‹è¯•2024å¹´ä¸ŠåŠå¹´ï¼ˆè¯¦ç»†åˆ†æï¼‰
```bash
python backtrader_demo.py --timeframe h1 --start 2024-01-01 --end 2024-06-30 --save-trades --plot
```

#### æµ‹è¯•å•ä¸ªå­£åº¦ï¼ˆæ—¥çº¿ï¼‰
```bash
python backtrader_demo.py --timeframe d1 --start 2024-01-01 --end 2024-03-31 --plot
```

#### æµ‹è¯•ä¸€å‘¨æ•°æ®ï¼ˆ5åˆ†é’Ÿçº¿ï¼‰
```bash
python backtrader_demo.py --timeframe m5 --start 2024-12-10 --end 2024-12-17 --save-trades
```

## ğŸ“Š è¾“å‡ºè¯´æ˜

### ç»ˆç«¯è¾“å‡º

è¿è¡Œåä¼šæ˜¾ç¤ºï¼š
```
============================================================
NQæœŸè´§å›æµ‹ç³»ç»Ÿ
============================================================

æ•°æ®æ–‡ä»¶: /Users/hong/PycharmProjects/prepareQD-BTC/btc_m1_cleaned.csv
æ­£åœ¨åŠ è½½æ¸…æ´—åçš„æ•°æ®...
å›æµ‹æ—¶é—´èŒƒå›´: 2024-01-01 åˆ° 2024-12-31
Kçº¿å‘¨æœŸ: 1å°æ—¶
âœ… æ•°æ®å·²é‡é‡‡æ ·ä¸º 1å°æ—¶
âœ… æ•°æ®åŠ è½½å®Œæˆ
ç­–ç•¥å‚æ•°: å¿«çº¿=10, æ…¢çº¿=30

============================================================
å¼€å§‹å›æµ‹...
åˆå§‹èµ„é‡‘: $100,000.00
============================================================

============================================================
å›æµ‹ç»“æœ
============================================================
æœ€ç»ˆèµ„é‡‘: $163,824.04
æ€»æ”¶ç›Š: $63,824.04
æ”¶ç›Šç‡: 63.82%

--- åˆ†æå™¨ç»“æœ ---
å¤æ™®æ¯”ç‡: N/A
æœ€å¤§å›æ’¤: 98.91%
æœ€é•¿å›æ’¤æœŸ: 275000 bars

æ€»äº¤æ˜“æ¬¡æ•°: 2177
ç›ˆåˆ©äº¤æ˜“: 527
äºæŸäº¤æ˜“: 1649
å¹³å‡ç›ˆåˆ©: $7,396.40
å¹³å‡äºæŸ: -$2,325.08

--- è‡ªå®šä¹‰åˆ†æ ---
äº¤æ˜“æ€»æ•°: 2176
èƒœç‡: 24.22%
å¹³å‡ç›ˆäº: $29.34
æ€»ç›ˆäº: $63,837.17

âœ… å›æµ‹å®Œæˆï¼
```

### CSVæ–‡ä»¶è¾“å‡ºï¼ˆä½¿ç”¨ --save-tradesï¼‰

æ–‡ä»¶ä¿å­˜åœ¨ï¼š`backtest_results/trades_{timeframe}_{start}_{end}_{timestamp}.csv`

åŒ…å«18ä¸ªå­—æ®µï¼š
- åŸºç¡€ä¿¡æ¯ï¼štrade_id, datetime, type, price
- äº¤æ˜“ç»†èŠ‚ï¼šsize, value, commission
- æŠ€æœ¯æŒ‡æ ‡ï¼šsma_fast, sma_slow, rsi, macd, macd_signal, atr
- è´¦æˆ·çŠ¶æ€ï¼športfolio_value, cash, position
- ç›ˆäºåˆ†æï¼špnl, pnl_percent

è¯¦ç»†è¯´æ˜è¯·æŸ¥çœ‹ï¼š`CSV_FILES_GUIDE.md`

### å›¾è¡¨è¾“å‡ºï¼ˆä½¿ç”¨ --plotï¼‰

å›¾è¡¨åŒ…å«ï¼š
- Kçº¿å›¾ï¼ˆçº¢æ¶¨ç»¿è·Œï¼‰
- æˆäº¤é‡
- æŠ€æœ¯æŒ‡æ ‡ï¼ˆSMAã€RSIã€MACDã€å¸ƒæ—å¸¦ï¼‰
- ä¹°å–ä¿¡å·æ ‡è®°
- è´¦æˆ·ä»·å€¼æ›²çº¿
- å›æ’¤æ›²çº¿

## ğŸ”§ é«˜çº§ç”¨æ³•

### æŸ¥çœ‹å¸®åŠ©ä¿¡æ¯
```bash
python backtrader_demo.py --help
```

### ä½¿ç”¨è‡ªå®šä¹‰æ•°æ®æ–‡ä»¶
```bash
python backtrader_demo.py --data /path/to/your/data.csv --timeframe h1
```

### æ‰¹é‡æµ‹è¯•ä¸åŒå‘¨æœŸ
```bash
#!/bin/bash
# åˆ›å»ºæ‰¹é‡æµ‹è¯•è„šæœ¬ test_all_timeframes.sh

for tf in m5 m15 m30 h1 h4 d1; do
    echo "Testing timeframe: $tf"
    python backtrader_demo.py --timeframe $tf --start 2024-01-01 --end 2024-12-31 --save-trades
done
```

### Pythonè„šæœ¬è°ƒç”¨
```python
import subprocess

# è¿è¡Œå›æµ‹
result = subprocess.run([
    'python', 'backtrader_demo.py',
    '--timeframe', 'h1',
    '--start', '2024-01-01',
    '--end', '2024-06-30',
    '--save-trades'
], capture_output=True, text=True)

print(result.stdout)
```

## âš ï¸ æ³¨æ„äº‹é¡¹

### æ•°æ®æ–‡ä»¶
- ç¡®ä¿ `btc_m1_cleaned.csv` æ–‡ä»¶å­˜åœ¨
- å¦‚æœæ²¡æœ‰æ¸…æ´—è¿‡æ•°æ®ï¼Œå…ˆè¿è¡Œæ•°æ®æ¸…æ´—ï¼ˆè§ä¸‹æ–‡ï¼‰

### æ—¶é—´èŒƒå›´
- å¼€å§‹æ—¥æœŸå¿…é¡»æ—©äºç»“æŸæ—¥æœŸ
- æ—¥æœŸæ ¼å¼å¿…é¡»æ˜¯ YYYY-MM-DD
- ç¡®ä¿æ—¥æœŸåœ¨æ•°æ®èŒƒå›´å†…ï¼ˆ2020-01-01 åˆ° 2025-12-19ï¼‰

### Kçº¿å‘¨æœŸ
- è¾ƒå°çš„å‘¨æœŸï¼ˆm1ã€m5ï¼‰æ•°æ®é‡å¤§ï¼Œè¿è¡Œæ—¶é—´é•¿
- å»ºè®®å…ˆç”¨å°èŒƒå›´æ•°æ®æµ‹è¯•
- æ—¥çº¿ï¼ˆd1ï¼‰é€‚åˆé•¿æ—¶é—´èŒƒå›´æµ‹è¯•

### å›¾è¡¨æ˜¾ç¤º
- éœ€è¦å®‰è£…matplotlibï¼š`pip install matplotlib`
- å›¾è¡¨çª—å£éœ€è¦æ‰‹åŠ¨å…³é—­æ‰èƒ½ç»§ç»­ç¨‹åº
- å¦‚æœæ— æ³•æ˜¾ç¤ºå›¾è¡¨ï¼Œæ£€æŸ¥å›¾å½¢ç¯å¢ƒé…ç½®

## ğŸ“š ç›¸å…³æ–‡æ¡£

- `README_backtrader.md` - å®Œæ•´è¯´æ˜æ–‡æ¡£
- `QUICK_START.md` - å¿«é€Ÿå¼€å§‹æŒ‡å—
- `CSV_FILES_GUIDE.md` - CSVæ–‡ä»¶è¯´æ˜
- `FEATURES.md` - åŠŸèƒ½ç‰¹æ€§è¯¦è§£
- `USAGE.md` - æœ¬æ–‡ä»¶ï¼ˆä½¿ç”¨è¯´æ˜ï¼‰

## ğŸ› ï¸ å¸¸è§é—®é¢˜

### Q1: å¦‚ä½•æ•°æ®æ¸…æ´—ï¼Ÿ
**A**: æ•°æ®å·²æ¸…æ´—å®Œæˆï¼ˆ`btc_m1_cleaned.csv`ï¼‰ï¼Œå¦‚éœ€é‡æ–°æ¸…æ´—ï¼š
```bash
python clean_btc_data.py
```

### Q2: å›æµ‹å¤ªæ…¢æ€ä¹ˆåŠï¼Ÿ
**A**: 
- ä½¿ç”¨è¾ƒå¤§çš„Kçº¿å‘¨æœŸï¼ˆh1ã€d1ï¼‰
- å‡å°æ—¶é—´èŒƒå›´
- å…³é—­å›¾è¡¨ç”Ÿæˆï¼ˆä¸ä½¿ç”¨--plotï¼‰

### Q3: å¦‚ä½•æŸ¥çœ‹äº¤æ˜“è®°å½•ï¼Ÿ
**A**: 
```bash
# æŸ¥çœ‹æœ€æ–°çš„äº¤æ˜“è®°å½•
ls -lt backtest_results/ | head -5

# ç”¨pandasæŸ¥çœ‹
python -c "import pandas as pd; df=pd.read_csv('backtest_results/trades_*.csv'); print(df.head())"
```

### Q4: å¦‚ä½•ä¿®æ”¹ç­–ç•¥å‚æ•°ï¼Ÿ
**A**: ç¼–è¾‘ `backtrader_demo.py` ä¸­çš„ `strategy_params` å­—å…¸

### Q5: æ”¯æŒå“ªäº›æ•°æ®æ ¼å¼ï¼Ÿ
**A**: CSVæ ¼å¼ï¼Œéœ€åŒ…å«ï¼šts_event, open, high, low, close, volume

### Q6: å¯ä»¥å®ç›˜äº¤æ˜“å—ï¼Ÿ
**A**: å½“å‰ä»…æ”¯æŒå›æµ‹ï¼Œå®ç›˜éœ€è¦è¿æ¥äº¤æ˜“æ¥å£ï¼ˆæœªå®ç°ï¼‰

## ğŸ’» ç³»ç»Ÿè¦æ±‚

- Python 3.7+
- backtrader
- pandas
- matplotlibï¼ˆå¯é€‰ï¼Œç”¨äºå›¾è¡¨ï¼‰

å®‰è£…ä¾èµ–ï¼š
```bash
pip install backtrader pandas matplotlib
```

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æŸ¥çœ‹ï¼š
1. è¿è¡Œ `python backtrader_demo.py --help` æŸ¥çœ‹å‚æ•°è¯´æ˜
2. æŸ¥çœ‹é”™è¯¯ä¿¡æ¯å’Œå †æ ˆè·Ÿè¸ª
3. æ£€æŸ¥æ•°æ®æ–‡ä»¶æ˜¯å¦å­˜åœ¨ä¸”æ ¼å¼æ­£ç¡®
4. ç¡®è®¤æ—¥æœŸèŒƒå›´å’Œå‚æ•°æ ¼å¼

---

**ç‰ˆæœ¬**: v2.0  
**æœ€åæ›´æ–°**: 2024-12-21

